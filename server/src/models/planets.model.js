const { parse } = require("csv-parse");
const fs = require("node:fs");
const path = require("node:path");


const habitablePlanets = [];

function isHabitable(planet) {
  return (
    planet["koi_disposition"] === "CONFIRMED" &&
    planet["koi_insol"] > 0.36 &&
    planet["koi_insol"] < 1.11 &&
    planet["koi_prad"] < 1.6
  );
}

// const promise = new Promise((resolve, reject) => { resolve(42) })
// promise.then((res) => {
//
// })
//  await result = await promise;

function loadPlanetsData() {
  return new Promise((resolve, reject) => {
    fs.createReadStream(
      path.join(__dirname, "..", "..", "data", "kepler_data.csv")
    )
      .pipe(parse({ comment: "#", columns: true }))
      .on("data", async (data) => {
        if (isHabitable(data)) {
          // console.log(data)
          return habitablePlanets.push(data);
        }
      })
      .on("error", (error) => {
        console.log(error);
        reject(error);
      })
      .on("end", () => {
        console.log("done");
        resolve();
      });
  });
}

const planetsObj = [
  {
    kepid: '11768142',
    kepoi_name: 'K02626.01',
    kepler_name: 'Kepler-1652 b',
    koi_disposition: 'CONFIRMED',
    koi_pdisposition: 'CANDIDATE',
    koi_score: '0.9990',
    koi_fpflag_nt: '0',
    koi_fpflag_ss: '0',
    koi_fpflag_co: '0',
    koi_fpflag_ec: '0',
    koi_period: '38.097071700',
    koi_period_err1: '3.0790000e-04',
    koi_period_err2: '-3.0790000e-04',
    koi_time0bk: '140.0035300',
    koi_time0bk_err1: '6.590000e-03',
    koi_time0bk_err2: '-6.590000e-03',
    koi_impact: '0.9530',
    koi_impact_err1: '0.0190',
    koi_impact_err2: '-0.6880',
    koi_duration: '4.30700',
    koi_duration_err1: '0.21000',
    koi_duration_err2: '-0.21000',
    koi_depth: '9.1330e+02',
    koi_depth_err1: '5.910e+01',
    koi_depth_err2: '-5.910e+01',
    koi_prad: '1.58',
    koi_prad_err1: '2.000e-01',
    koi_prad_err2: '-2.100e-01',
    koi_teq: '242.0',
    koi_teq_err1: '',
    koi_teq_err2: '',
    koi_insol: '0.81',
    koi_insol_err1: '0.30',
    koi_insol_err2: '-0.25',
    koi_model_snr: '17.00',
    koi_tce_plnt_num: '1',
    koi_tce_delivname: 'q1_q17_dr25_tce',
    koi_steff: '3554.00',
    koi_steff_err1: '71.00',
    koi_steff_err2: '-80.00',
    koi_slogg: '4.867',
    koi_slogg_err1: '0.055',
    koi_slogg_err2: '-0.055',
    koi_srad: '0.3980',
    koi_srad_err1: '0.0490',
    koi_srad_err2: '-0.0540',
    ra: '294.366090',
    dec: '49.915058',
    koi_kepmag: '15.931'
  },
  {
    kepid: '3642335',
    kepoi_name: 'K03010.01',
    kepler_name: 'Kepler-1410 b',
    koi_disposition: 'CONFIRMED',
    koi_pdisposition: 'CANDIDATE',
    koi_score: '0.9960',
    koi_fpflag_nt: '0',
    koi_fpflag_ss: '0',
    koi_fpflag_co: '0',
    koi_fpflag_ec: '0',
    koi_period: '60.866097400',
    koi_period_err1: '6.4970000e-04',
    koi_period_err2: '-6.4970000e-04',
    koi_time0bk: '179.2867400',
    koi_time0bk_err1: '7.870000e-03',
    koi_time0bk_err2: '-7.870000e-03',
    koi_impact: '0.0040',
    koi_impact_err1: '0.4630',
    koi_impact_err2: '-0.0040',
    koi_duration: '4.39700',
    koi_duration_err1: '0.23800',
    koi_duration_err2: '-0.23800',
    koi_depth: '7.1430e+02',
    koi_depth_err1: '5.370e+01',
    koi_depth_err2: '-5.370e+01',
    koi_prad: '1.39',
    koi_prad_err1: '7.000e-02',
    koi_prad_err2: '-1.000e-01',
    koi_teq: '244.0',
    koi_teq_err1: '',
    koi_teq_err2: '',
    koi_insol: '0.84',
    koi_insol_err1: '0.17',
    koi_insol_err2: '-0.16',
    koi_model_snr: '15.40',
    koi_tce_plnt_num: '1',
    koi_tce_delivname: 'q1_q17_dr25_tce',
    koi_steff: '3808.00',
    koi_steff_err1: '69.00',
    koi_steff_err2: '-76.00',
    koi_slogg: '4.734',
    koi_slogg_err1: '0.033',
    koi_slogg_err2: '-0.027',
    koi_srad: '0.5220',
    koi_srad_err1: '0.0280',
    koi_srad_err2: '-0.0350',
    ra: '290.510190',
    dec: '38.743542',
    koi_kepmag: '15.757'
  },
  {
    kepid: '11497958',
    kepoi_name: 'K01422.04',
    kepler_name: 'Kepler-296 f',
    koi_disposition: 'CONFIRMED',
    koi_pdisposition: 'CANDIDATE',
    koi_score: '0.9270',
    koi_fpflag_nt: '0',
    koi_fpflag_ss: '0',
    koi_fpflag_co: '0',
    koi_fpflag_ec: '0',
    koi_period: '63.335471900',
    koi_period_err1: '9.2700000e-04',
    koi_period_err2: '-9.2700000e-04',
    koi_time0bk: '162.6161000',
    koi_time0bk_err1: '1.110000e-02',
    koi_time0bk_err2: '-1.110000e-02',
    koi_impact: '0.0290',
    koi_impact_err1: '0.4220',
    koi_impact_err2: '-0.0290',
    koi_duration: '3.65100',
    koi_duration_err1: '0.25100',
    koi_duration_err2: '-0.25100',
    koi_depth: '9.8300e+02',
    koi_depth_err1: '8.380e+01',
    koi_depth_err2: '-8.380e+01',
    koi_prad: '1.18',
    koi_prad_err1: '1.500e-01',
    koi_prad_err2: '-1.800e-01',
    koi_teq: '202.0',
    koi_teq_err1: '',
    koi_teq_err2: '',
    koi_insol: '0.39',
    koi_insol_err1: '0.15',
    koi_insol_err2: '-0.13',
    koi_model_snr: '13.00',
    koi_tce_plnt_num: '5',
    koi_tce_delivname: 'q1_q17_dr25_tce',
    koi_steff: '3526.00',
    koi_steff_err1: '71.00',
    koi_steff_err2: '-78.00',
    koi_slogg: '4.866',
    koi_slogg_err1: '0.066',
    koi_slogg_err2: '-0.044',
    koi_srad: '0.3830',
    koi_srad_err1: '0.0480',
    koi_srad_err2: '-0.0580',
    ra: '286.540010',
    dec: '49.437328',
    koi_kepmag: '15.921'
  },
  {
    kepid: '4138008',
    kepoi_name: 'K04742.01',
    kepler_name: 'Kepler-442 b',
    koi_disposition: 'CONFIRMED',
    koi_pdisposition: 'CANDIDATE',
    koi_score: '0.9930',
    koi_fpflag_nt: '0',
    koi_fpflag_ss: '0',
    koi_fpflag_co: '0',
    koi_fpflag_ec: '0',
    koi_period: '112.303136000',
    koi_period_err1: '1.7220000e-03',
    koi_period_err2: '-1.7220000e-03',
    koi_time0bk: '230.4383000',
    koi_time0bk_err1: '1.250000e-02',
    koi_time0bk_err2: '-1.250000e-02',
    koi_impact: '0.2480',
    koi_impact_err1: '0.1910',
    koi_impact_err2: '-0.2480',
    koi_duration: '5.86900',
    koi_duration_err1: '0.36200',
    koi_duration_err2: '-0.36200',
    koi_depth: '5.0210e+02',
    koi_depth_err1: '4.410e+01',
    koi_depth_err2: '-4.410e+01',
    koi_prad: '1.30',
    koi_prad_err1: '7.000e-02',
    koi_prad_err2: '-5.000e-02',
    koi_teq: '241.0',
    koi_teq_err1: '',
    koi_teq_err2: '',
    koi_insol: '0.79',
    koi_insol_err1: '0.15',
    koi_insol_err2: '-0.11',
    koi_model_snr: '13.10',
    koi_tce_plnt_num: '1',
    koi_tce_delivname: 'q1_q17_dr25_tce',
    koi_steff: '4401.00',
    koi_steff_err1: '78.00',
    koi_steff_err2: '-78.00',
    koi_slogg: '4.677',
    koi_slogg_err1: '0.017',
    koi_slogg_err2: '-0.027',
    koi_srad: '0.5950',
    koi_srad_err1: '0.0300',
    koi_srad_err2: '-0.0240',
    ra: '285.366580',
    dec: '39.280079',
    koi_kepmag: '14.976'
  },
  {
    kepid: '11497958',
    kepoi_name: 'K01422.05',
    kepler_name: 'Kepler-296 e',
    koi_disposition: 'CONFIRMED',
    koi_pdisposition: 'CANDIDATE',
    koi_score: '0.9840',
    koi_fpflag_nt: '0',
    koi_fpflag_ss: '0',
    koi_fpflag_co: '0',
    koi_fpflag_ec: '0',
    koi_period: '34.142050600',
    koi_period_err1: '2.2890000e-04',
    koi_period_err2: '-2.2890000e-04',
    koi_time0bk: '136.0362400',
    koi_time0bk_err1: '5.590000e-03',
    koi_time0bk_err2: '-5.590000e-03',
    koi_impact: '0.1050',
    koi_impact_err1: '0.3340',
    koi_impact_err2: '-0.1050',
    koi_duration: '2.94500',
    koi_duration_err1: '0.17900',
    koi_duration_err2: '-0.17900',
    koi_depth: '7.8800e+02',
    koi_depth_err1: '6.310e+01',
    koi_depth_err2: '-6.310e+01',
    koi_prad: '1.06',
    koi_prad_err1: '1.300e-01',
    koi_prad_err2: '-1.600e-01',
    koi_teq: '248.0',
    koi_teq_err1: '',
    koi_teq_err2: '',
    koi_insol: '0.89',
    koi_insol_err1: '0.33',
    koi_insol_err2: '-0.30',
    koi_model_snr: '13.30',
    koi_tce_plnt_num: '4',
    koi_tce_delivname: 'q1_q17_dr25_tce',
    koi_steff: '3526.00',
    koi_steff_err1: '71.00',
    koi_steff_err2: '-78.00',
    koi_slogg: '4.866',
    koi_slogg_err1: '0.066',
    koi_slogg_err2: '-0.044',
    koi_srad: '0.3830',
    koi_srad_err1: '0.0480',
    koi_srad_err2: '-0.0580',
    ra: '286.540010',
    dec: '49.437328',
    koi_kepmag: '15.921'
  },
  {
    kepid: '6444896',
    kepoi_name: 'K03138.01',
    kepler_name: 'Kepler-1649 b',
    koi_disposition: 'CONFIRMED',
    koi_pdisposition: 'CANDIDATE',
    koi_score: '1.0000',
    koi_fpflag_nt: '0',
    koi_fpflag_ss: '0',
    koi_fpflag_co: '0',
    koi_fpflag_ec: '0',
    koi_period: '8.689107640',
    koi_period_err1: '3.3640000e-05',
    koi_period_err2: '-3.3640000e-05',
    koi_time0bk: '133.2355900',
    koi_time0bk_err1: '3.880000e-03',
    koi_time0bk_err2: '-3.880000e-03',
    koi_impact: '0.0490',
    koi_impact_err1: '0.4170',
    koi_impact_err2: '-0.0490',
    koi_duration: '1.16270',
    koi_duration_err1: '0.09510',
    koi_duration_err2: '-0.09510',
    koi_depth: '1.6790e+03',
    koi_depth_err1: '1.340e+02',
    koi_depth_err2: '-1.340e+02',
    koi_prad: '0.49',
    koi_prad_err1: '0.000e+00',
    koi_prad_err2: '0.000e+00',
    koi_teq: '211.0',
    koi_teq_err1: '',
    koi_teq_err2: '',
    koi_insol: '0.47',
    koi_insol_err1: '0.00',
    koi_insol_err2: '0.00',
    koi_model_snr: '9.60',
    koi_tce_plnt_num: '1',
    koi_tce_delivname: 'q1_q17_dr25_tce',
    koi_steff: '2703.00',
    koi_steff_err1: '0.00',
    koi_steff_err2: '0.00',
    koi_slogg: '5.274',
    koi_slogg_err1: '0.000',
    koi_slogg_err2: '0.000',
    koi_srad: '0.1180',
    koi_srad_err1: '0.0000',
    koi_srad_err2: '0.0000',
    ra: '292.503780',
    dec: '41.830421',
    koi_kepmag: '17.131'
  },
  {
    kepid: '9002278',
    kepoi_name: 'K00701.04',
    kepler_name: 'Kepler-62 f',
    koi_disposition: 'CONFIRMED',
    koi_pdisposition: 'CANDIDATE',
    koi_score: '0.0000',
    koi_fpflag_nt: '0',
    koi_fpflag_ss: '0',
    koi_fpflag_co: '0',
    koi_fpflag_ec: '0',
    koi_period: '267.282521000',
    koi_period_err1: '4.8100000e-03',
    koi_period_err2: '-4.8100000e-03',
    koi_time0bk: '589.7197500',
    koi_time0bk_err1: '9.160000e-03',
    koi_time0bk_err2: '-9.160000e-03',
    koi_impact: '0.3780',
    koi_impact_err1: '0.0920',
    koi_impact_err2: '-0.3780',
    koi_duration: '7.78800',
    koi_duration_err1: '0.37400',
    koi_duration_err2: '-0.37400',
    koi_depth: '4.7190e+02',
    koi_depth_err1: '2.690e+01',
    koi_depth_err2: '-2.690e+01',
    koi_prad: '1.43',
    koi_prad_err1: '8.000e-02',
    koi_prad_err2: '-6.000e-02',
    koi_teq: '207.0',
    koi_teq_err1: '',
    koi_teq_err2: '',
    koi_insol: '0.44',
    koi_insol_err1: '0.09',
    koi_insol_err2: '-0.07',
    koi_model_snr: '19.30',
    koi_tce_plnt_num: '4',
    koi_tce_delivname: 'q1_q17_dr25_tce',
    koi_steff: '4926.00',
    koi_steff_err1: '98.00',
    koi_steff_err2: '-98.00',
    koi_slogg: '4.653',
    koi_slogg_err1: '0.017',
    koi_slogg_err2: '-0.049',
    koi_srad: '0.6620',
    koi_srad_err1: '0.0410',
    koi_srad_err2: '-0.0270',
    ra: '283.212740',
    dec: '45.349861',
    koi_kepmag: '13.725'
  },
  {
    kepid: '8311864',
    kepoi_name: 'K07016.01',
    kepler_name: 'Kepler-452 b',
    koi_disposition: 'CONFIRMED',
    koi_pdisposition: 'CANDIDATE',
    koi_score: '0.7710',
    koi_fpflag_nt: '0',
    koi_fpflag_ss: '0',
    koi_fpflag_co: '0',
    koi_fpflag_ec: '0',
    koi_period: '384.847556000',
    koi_period_err1: '7.1050000e-03',
    koi_period_err2: '-7.1050000e-03',
    koi_time0bk: '314.9700000',
    koi_time0bk_err1: '1.520000e-02',
    koi_time0bk_err2: '-1.520000e-02',
    koi_impact: '0.0590',
    koi_impact_err1: '0.3870',
    koi_impact_err2: '-0.0590',
    koi_duration: '9.96900',
    koi_duration_err1: '0.44100',
    koi_duration_err2: '-0.44100',
    koi_depth: '1.8990e+02',
    koi_depth_err1: '1.760e+01',
    koi_depth_err2: '-1.760e+01',
    koi_prad: '1.09',
    koi_prad_err1: '2.000e-01',
    koi_prad_err2: '-1.000e-01',
    koi_teq: '220.0',
    koi_teq_err1: '',
    koi_teq_err2: '',
    koi_insol: '0.56',
    koi_insol_err1: '0.32',
    koi_insol_err2: '-0.15',
    koi_model_snr: '12.30',
    koi_tce_plnt_num: '1',
    koi_tce_delivname: 'q1_q17_dr25_tce',
    koi_steff: '5579.00',
    koi_steff_err1: '150.00',
    koi_steff_err2: '-150.00',
    koi_slogg: '4.580',
    koi_slogg_err1: '0.034',
    koi_slogg_err2: '-0.127',
    koi_srad: '0.7980',
    koi_srad_err1: '0.1500',
    koi_srad_err2: '-0.0750',
    ra: '296.003690',
    dec: '44.277561',
    koi_kepmag: '13.426'
  }
];


module.exports = {
  planetsObj,
  planets: habitablePlanets,
  loadPlanetsData
};
